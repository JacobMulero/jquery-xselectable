(function(f,h,k,p){var u={distance:0,disabled:false,cancel:":input,option",filter:"*",scrollingThreshold:100,scrollSpeedMultiplier:1,scroller:null,positioner:null},w=function(a){var b=f(a).data("xselectable").containerDimensions,c=typeof h.innerWidth=="number"?h.innerWidth:k.documentElement.clientWidth,d=typeof h.innerHeight=="number"?h.innerHeight:k.documentElement.clientHeight;return{getScrollableElement:function(){return k.documentElement},getScrollBorders:function(){var e=typeof h.pageYOffset==
"number"?h.pageYOffset:k.documentElement.scrollTop,g=typeof h.pageXOffset=="number"?h.pageXOffset:k.documentElement.scrollLeft;return[e,g+c,e+d,g]},getScrollableDistances:function(){var e=typeof h.pageYOffset=="number"?h.pageYOffset:k.documentElement.scrollTop,g=typeof h.pageXOffset=="number"?h.pageXOffset:k.documentElement.scrollLeft;return[Math.max(e-b.top,0),Math.max(b.left+b.width-g-c,0),Math.max(b.top+b.height-e-d,0),Math.max(g-b.left,0)]},scroll:function(e,g){e=="vertical"?h.scrollBy(0,g):h.scrollBy(g,
0)},getScrollOffset:function(){return{top:0,left:0}},next:v(a)}},v=function(a){var b=f(a).data("xselectable").containerDimensions;return{getScrollableDistances:function(){return[a.scrollTop,a.scrollWidth-a.scrollLeft-b.width,a.scrollHeight-a.scrollTop-b.height,a.scrollLeft]},scroll:function(c,d){a[c=="vertical"?"scrollTop":"scrollLeft"]+=d},getScrollOffset:function(){return{top:0,left:0}}}},x=function(){var a=f(this).data("xselectable").containerDimensions;return[a.top,a.left+a.width,a.top+a.height,
a.left]},y=function(a){return{top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}},z=function(){var a=f(this),b=a.data("xselectable");b.selectionGlass=f("<div />",{"class":"xselectable-glass"}).css({position:"absolute",top:0,left:0,height:this.scrollHeight,width:this.scrollWidth,overflow:"hidden"}).appendTo(a);b.selectionBox=f("<div />",{"class":"xselectable-box"}).css({position:"absolute"}).appendTo(b.selectionGlass)},A=function(){var a=this,b=f(this),c=b.data("xselectable"),
d=[];b.find(c.options.filter).each(function(){var e=(c.options.positioner||y).call(a,this);e.element=this;e.selected=false;d.push(e)}).removeClass("xselectable-selected");c.selectables=d},s=function(a,b,c){var d=f(this).data("xselectable"),e=d.options.scrollingThreshold,g=d.options.scrollSpeedMultiplier;if(d.scrollingTimeout){h.clearTimeout(d.scrollingTimeout);delete d.scrollingTimeout}var i=c?((new Date).getTime()-c)/16:1,l=false,B=b.getScrollableDistances(),m=b.getScrollBorders?b.getScrollBorders():
x.call(this),C=b.getScrollableElement?b.getScrollableElement():this;m=[{distance:Math.max(a.pageY-m[0],0),direction:-1,scrollAxis:"vertical",positionProperty:"pageY"},{distance:Math.max(m[1]-a.pageX,0),direction:1,scrollAxis:"horizontal",positionProperty:"pageX"},{distance:Math.max(m[2]-a.pageY,0),direction:1,scrollAxis:"vertical",positionProperty:"pageY"},{distance:Math.max(a.pageX-m[3],0),direction:-1,scrollAxis:"horizontal",positionProperty:"pageX"}];for(var o=m.length-1;o>=0;o--){var j=m[o],q=
B[o];if(j.distance<e&&q>0&&(d.curPosition[j.positionProperty]-d.lastPosition[j.positionProperty]>0?1:d.curPosition[j.positionProperty]-d.lastPosition[j.positionProperty]<0?-1:0)==j.direction){l=j.direction*Math.round(Math.min(q,Math.ceil((e-j.distance)/10)*i*g));b.scroll(j.scrollAxis,l);if(C==this){d.startPosition[j.positionProperty]-=l;d.curPosition[j.positionProperty]-=l}else a[j.positionProperty]+=l;l=true}}if(l)d.scrollingTimeout=h.setTimeout(f.proxy(function(){r.call(this,a,c)},this),16);else b.next&&
s.call(this,a,b.next,c)},t=function(a,b,c,d){b=a+b;d=c+d;return c>=a&&c<=b||d>=a&&d<=b||c<=a&&d>=b},E=function(a){var b=f(this),c=b.data("xselectable");if(a.which==1){var d=[c.options.cancel,c.options.cancel+" *"].join(",");if(!(c.options.cancel&&f(a.target).is(d)))if(!(a.pageX>b.offset().left+this.clientWidth||a.pageY>b.offset().top+this.clientHeight)){c.containerDimensions={top:b.offset().top+(b.outerHeight(false)-b.innerHeight())/2,left:b.offset().left+(b.outerWidth(false)-b.innerWidth())/2,width:this.clientWidth,
height:this.clientHeight};c.startPosition={pageX:a.pageX,pageY:a.pageY};c.curPosition={pageX:a.pageX,pageY:a.pageY};c.scroller=(c.options.scroller||w).call(this,this);c.mouseupHandler=f.proxy(D,this);f(k).bind("mouseup.xselectable",c.mouseupHandler);f(k).bind("mousemove.xselectable",f.proxy(r,this));b.bind("mousewheel.xselectable",function(e){e.preventDefault();return false});a.preventDefault()}}},r=function(a,b){var c=f(this),d=c.data("xselectable"),e=d.scroller,g=d.options.distance;if(!(!d.selectionBox&&
Math.abs(d.startPosition.pageX-a.pageX)<g&&Math.abs(d.startPosition.pageY-a.pageY)<g)){d.lastPosition=d.curPosition;d.curPosition={pageX:a.pageX,pageY:a.pageY};if(!d.selectionBox){c.trigger("xselectablestart");z.apply(this);A.apply(this)}s.call(this,a,e,b);c=f(this).data("xselectable");c.selectionBoxExtents={top:Math.min(c.startPosition.pageY,a.pageY)-c.containerDimensions.top+this.scrollTop,left:Math.min(c.startPosition.pageX,a.pageX)-c.containerDimensions.left+this.scrollLeft,height:Math.abs(c.startPosition.pageY-
a.pageY),width:Math.abs(c.startPosition.pageX-a.pageX)};c.selectionBox.css(c.selectionBoxExtents);c=f(this);d=c.data("xselectable");g={top:0,left:0};for(e=e;e;){var i=e.getScrollOffset();g.top+=i.top;g.left+=i.left;e=e.next}for(e=d.selectables.length-1;e>=0;e--){i=d.selectables[e];if(t(d.selectionBoxExtents.top,d.selectionBoxExtents.height,i.top+g.top,i.height)&&t(d.selectionBoxExtents.left,d.selectionBoxExtents.width,i.left+g.left,i.width)){if(!i.selected){f(i.element).addClass("xselectable-selected");
i.selected=true;c.trigger("xselectableselecting",{selecting:i.element})}}else if(i.selected){f(i.element).removeClass("xselectable-selected");i.selected=false;c.trigger("xselectableunselecting",{unselecting:i.element})}}}},D=function(){var a=f(this),b=a.data("xselectable");if(b.scrollingTimeout){h.clearTimeout(b.scrollingTimeout);delete b.scrollingTimeout}a.unbind("mousewheel.xselectable");f(k).unbind("mousemove.xselectable");f(k).unbind("mouseup.xselectable",b.mouseupHandler);b.mouseupHandler=p;
if(b.selectionBox){b.selectionBox.remove();delete b.selectionBox;b.selectionGlass.remove();delete b.selectionGlass;for(var c=[],d=[],e=b.selectables.length-1;e>=0;e--)(b.selectables[e].selected?c:d).push(b.selectables[e].element);delete b.selectables;a.trigger("xselectableselected",{selected:c});a.trigger("xselectableunselected",{unselected:d});a.trigger("xselectablestop")}},n={init:function(a){this.each(function(){f(this).data("xselectable",{options:f.extend({},u,a)})});if(this.data("xselectable").options.disabled)return this;
return n.enable.apply(this)},destroy:function(){n.disable.apply(this);return this.removeData("xselectable")},enable:function(){return this.each(function(){var a=f(this);a.data("xselectable").options.disabled=false;a.bind("mousedown.xselectable",E)})},disable:function(){return this.each(function(){var a=f(this);a.data("xselectable").options.disabled=true;a.unbind(".xselectable")})},option:function(a,b){var c=this.first().data("xselectable").options;if(b===p)return c[a];else{c[a]=b;if(a=="disabled")b?
n.disable.apply(this):n.enable.apply(this);return this}}};f.fn.xselectable=function(a){if(n[a])return n[a].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof a==="object"||!a)return n.init.apply(this,arguments);else f.error("Method "+a+" does not exist on jQuery.xselectable")}})(jQuery,window,document);
