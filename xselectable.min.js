(function(e,n,l,o){var s={distance:0,disabled:false,cancel:":input,option",filter:"*",scrollingThreshold:100,scrollSpeedMultiplier:1,scroller:null,positioner:null},t=function(a){var c=e(a).data("xselectable").containerDimensions;return{getScrollableDistances:function(){return[a.scrollTop,a.scrollWidth-a.scrollLeft-c.width,a.scrollHeight-a.scrollTop-c.height,a.scrollLeft]},scroll:function(b,d){a[b=="vertical"?"scrollTop":"scrollLeft"]+=d},getScrollOffset:function(){return{top:0,left:0}}}},u=function(a){return{top:a.offsetTop,
left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}},v=function(){var a=e(this),c=a.data("xselectable");c.selectionGlass=e("<div />",{"class":"xselectable-glass"}).css({position:"absolute",top:0,left:0,height:this.scrollHeight,width:this.scrollWidth,overflow:"hidden"}).appendTo(a);c.selectionBox=e("<div />",{"class":"xselectable-box"}).css({position:"absolute"}).appendTo(c.selectionGlass)},w=function(){var a=this,c=e(this),b=c.data("xselectable"),d=[];c.find(b.options.filter).each(function(){var f=
(b.options.positioner||u).call(a,this);f.element=this;f.selected=false;d.push(f)}).removeClass("xselectable-selected");b.selectables=d},z=function(a,c){var b=e(this).data("xselectable"),d=b.scroller,f=b.containerDimensions,j=b.options.scrollingThreshold,g=b.options.scrollSpeedMultiplier;if(b.scrollingTimeout){n.clearTimeout(b.scrollingTimeout);delete b.scrollingTimeout}f=[{distance:Math.max(a.pageY-f.top,0),direction:-1,scrollAxis:"vertical",positionProperty:"pageY"},{distance:Math.max(f.left+f.width-
a.pageX,0),direction:1,scrollAxis:"horizontal",positionProperty:"pageX"},{distance:Math.max(f.top+f.height-a.pageY,0),direction:1,scrollAxis:"vertical",positionProperty:"pageY"},{distance:Math.max(a.pageX-f.left,0),direction:-1,scrollAxis:"horizontal",positionProperty:"pageX"}];var k=false,x=d.getScrollableDistances(),y=c?((new Date).getTime()-c)/16:1;c=(new Date).getTime();for(var m=f.length-1;m>=0;m--){var h=f[m],p=x[m];if(h.distance<j&&p>0&&(b.curPosition[h.positionProperty]-b.lastPosition[h.positionProperty]>
0?1:b.curPosition[h.positionProperty]-b.lastPosition[h.positionProperty]<0?-1:0)==h.direction){k=h.direction*Math.round(Math.min(p,Math.ceil((j-h.distance)/10)*y*g));d.scroll(h.scrollAxis,k);b.startPosition[h.positionProperty]-=k;b.curPosition[h.positionProperty]-=k;k=true}}if(k)b.scrollingTimeout=n.setTimeout(e.proxy(function(){q.call(this,a,c)},this),16)},r=function(a,c,b,d){c=a+c;d=b+d;return b>=a&&b<=c||d>=a&&d<=c||b<=a&&d>=c},B=function(a){var c=e(this),b=c.data("xselectable");if(a.which==1){var d=
[b.options.cancel,b.options.cancel+" *"].join(",");if(!(b.options.cancel&&e(a.target).is(d)))if(!(a.pageX>c.offset().left+this.clientWidth||a.pageY>c.offset().top+this.clientHeight)){b.containerDimensions={top:c.offset().top+(c.outerHeight(false)-c.innerHeight())/2,left:c.offset().left+(c.outerWidth(false)-c.innerWidth())/2,width:this.clientWidth,height:this.clientHeight};b.startPosition={pageX:a.pageX,pageY:a.pageY};b.curPosition={pageX:a.pageX,pageY:a.pageY};b.scroller=(b.options.scroller||t).call(this,
this);b.mouseupHandler=e.proxy(A,this);e(l).bind("mouseup.xselectable",b.mouseupHandler);e(l).bind("mousemove.xselectable",e.proxy(q,this));c.bind("mousewheel.xselectable",function(f){f.preventDefault();return false});a.preventDefault()}}},q=function(a,c){var b=e(this),d=b.data("xselectable"),f=d.options.distance;if(!(!d.selectionBox&&Math.abs(d.startPosition.pageX-a.pageX)<f&&Math.abs(d.startPosition.pageY-a.pageY)<f)){d.lastPosition=d.curPosition;d.curPosition={pageX:a.pageX,pageY:a.pageY};if(!d.selectionBox){b.trigger("xselectablestart");
v.apply(this);w.apply(this)}z.call(this,a,c);b=e(this).data("xselectable");b.selectionBoxExtents={top:Math.min(b.startPosition.pageY,a.pageY)-b.containerDimensions.top+this.scrollTop,left:Math.min(b.startPosition.pageX,a.pageX)-b.containerDimensions.left+this.scrollLeft,height:Math.abs(b.startPosition.pageY-a.pageY),width:Math.abs(b.startPosition.pageX-a.pageX)};b.selectionBox.css(b.selectionBoxExtents);b=e(this);d=b.data("xselectable");f=d.scroller.getScrollOffset();for(var j=d.selectables.length-
1;j>=0;j--){var g=d.selectables[j];if(r(d.selectionBoxExtents.top,d.selectionBoxExtents.height,g.top+f.top,g.height)&&r(d.selectionBoxExtents.left,d.selectionBoxExtents.width,g.left+f.left,g.width)){if(!g.selected){e(g.element).addClass("xselectable-selected");g.selected=true;b.trigger("xselectableselecting",{selecting:g.element})}}else if(g.selected){e(g.element).removeClass("xselectable-selected");g.selected=false;b.trigger("xselectableunselecting",{unselecting:g.element})}}}},A=function(){var a=
e(this),c=a.data("xselectable");if(c.scrollingTimeout){n.clearTimeout(c.scrollingTimeout);delete c.scrollingTimeout}a.unbind("mousewheel.xselectable");e(l).unbind("mousemove.xselectable");e(l).unbind("mouseup.xselectable",c.mouseupHandler);c.mouseupHandler=o;if(c.selectionBox){c.selectionBox.remove();delete c.selectionBox;c.selectionGlass.remove();delete c.selectionGlass;for(var b=[],d=[],f=c.selectables.length-1;f>=0;f--)(c.selectables[f].selected?b:d).push(c.selectables[f].element);delete c.selectables;
a.trigger("xselectableselected",{selected:b});a.trigger("xselectableunselected",{unselected:d});a.trigger("xselectablestop")}},i={init:function(a){this.each(function(){e(this).data("xselectable",{options:e.extend({},s,a)})});if(this.data("xselectable").options.disabled)return this;return i.enable.apply(this)},destroy:function(){i.disable.apply(this);return this.removeData("xselectable")},enable:function(){return this.each(function(){var a=e(this);a.data("xselectable").options.disabled=false;a.bind("mousedown.xselectable",
B)})},disable:function(){return this.each(function(){var a=e(this);a.data("xselectable").options.disabled=true;a.unbind(".xselectable")})},option:function(a,c){var b=this.first().data("xselectable").options;if(c===o)return b[a];else{b[a]=c;if(a=="disabled")c?i.disable.apply(this):i.enable.apply(this);return this}}};e.fn.xselectable=function(a){if(i[a])return i[a].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof a==="object"||!a)return i.init.apply(this,arguments);else e.error("Method "+
a+" does not exist on jQuery.xselectable")}})(jQuery,window,document);
